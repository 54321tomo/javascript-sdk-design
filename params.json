{"name":"Javascript-sdk-design","tagline":"Javascript SDK design guide extracted from work and personal experience","body":"# Javascript SDK Design Guide\r\n\r\n## Introduction\r\n\r\nThis guide gives you an introduction to develop a javascript sdk \r\non desktop and mobile web in different platforms and browsers (<99.99% I might skip some browsers). \r\n\r\nSince I didn't find out a better documentation for the javascript sdk,\r\nI'm here to collect and note down the knowledges from my experiences.\r\n\r\nFeel free to edit it if you think there's a better design methodology or \r\nany others I didn't mention here.\r\n\r\n*(inspired by [http-api-design](https://github.com/interagent/http-api-design))*\r\n\r\n## Content\r\n* [What is SDK](#what-is-sdk)\r\n* [Design Philosophy](#design-philosophy)\r\n* [Include the SDK](#include-the-sdk)\r\n  * [Asynchronous Syntax](#asynchronous-syntax)\r\n  * [Traditional Syntax](#traditional-syntax)\r\n  * [Comparison](#comparison)\r\n  * [Problem of Asynchronous](#problem-of-asynchronous)\r\n* [SDK Versioning](#sdk-versioning)\r\n* [Changelog Document](#changelog-document)\r\n* [Namespace](#namespace)\r\n* [Storage Mechanism](#storage-mechanism)\r\n  * [Cookie](#cookie)\r\n    * [Check Cookie Writable](#check-cookie-writable)\r\n    * [Check Third Party Cookie Writable](#check-third-party-cookie-writable)\r\n  * [Session](#session)\r\n  * [LocalStorage](#localstorage)\r\n    * [Check LocalStorage Writable](#check-localstorage-writable)\r\n  * [SessionStorage](#sessionstorage)\r\n    * [Check SessionStorage Writable](#check-sessionstorage-writable)\r\n* [Request](#request)\r\n  * [Image Beacon](#image-beacon)\r\n  * [Single Post](#single-post)\r\n  * [Multiple Post](#multiple-post)\r\n  * [Iframe](#iframe)\r\n  * [XMLHttpRequest](#xmlhttprequest)\r\n* [Component of URI](#component-of-uri)\r\n * [Parsing URI](#parsing-uri)\r\n* [Book to Read](#book-to-read)\r\n* [Reference](#reference)\r\n\r\n## What is SDK\r\n\r\nI know it's very common, but it is.\r\n\r\n\"Short for **software development kit**, a programming package that enables a programmer to develop applications for a specific platform. Typically an SDK includes one or more APIs, programming tools, and documentation.\"\r\n\r\n## Design Philosophy\r\n\r\nIt depends on your purpose of your SDK service and usage, \r\nbut there must be **native**, **short**, **fast**, **clean** and **readable**.\r\n\r\nWritten in native javascript code, compiler language like \r\nlivescript, coffeescript, typescript and others are not recommend.\r\nThere must be a better way to write your own javascript code in native faster than others.\r\n\r\nPlease don't involve jQuery in your SDK unless it's really important, \r\nyou can have other jQuery-like libraries, zepto.js, for the DOM manipulation. \r\nOr if you need the http ajax request, use other light library like `window.fetch`.\r\n\r\nOnce every SDK version released, make sure that it can be fitted into older and newer SDK version in the future. \r\nTherefore, remember to write your **Documentation** for your SDK and comment for your code.\r\n\r\n\r\n## Include the SDK\r\n\r\nYou are suggest to use **Asynchrnonous Syntax** for your script loaded.\r\nWe want to optimize the user experience on the website as we don't want our SDK library interfere the main web loaded.\r\n\r\n### Asynchronous Syntax\r\n\r\n```html\r\n<script>\r\n  (function () {\r\n    var s = document.createElement('script');\r\n    s.type = 'text/javascript';\r\n    s.async = true;\r\n    s.src = 'http://xxx.com/sdk.js';\r\n    var x = document.getElementsByTagName('script')[0];\r\n    x.parentNode.insertBefore(s, x);\r\n  })();\r\n</script>\r\n```\r\n\r\nTarget on modern browser, you can use `async`.\r\n\r\n```html\r\n<script async src=\"http://xxx.com/sdk.js\"></script>\r\n```\r\n\r\n### Traditional Syntax\r\n\r\n```html\r\n<script type=\"text/javascript\" src=\"http://xxx.com/sdk.js\"></script>\r\n```\r\n\r\n### Comparison\r\n\r\nHere's the simple graph to show the differentiate between Asynchronous and Traditional Syntax.\r\n\r\nAsynchronous:\r\n```\r\n |----A-----|\r\n    |-----B-----------| \r\n        |-------C------|\r\n```\r\n\r\nSynchronous:\r\n```\r\n|----A-----||-----B-----------||-------C------|\r\n```\r\n\r\n### Problem of Asynchronous\r\n\r\nWhen you are using Asynchronous,\r\nyou cannot execute your SDK function which script written within the page.\r\n\r\n```js\r\n<script>\r\n  (function () {\r\n    var s = document.createElement('script');\r\n    s.type = 'text/javascript';\r\n    s.async = true;\r\n    s.src = 'http://xxx.com/sdk.js';\r\n    var x = document.getElementsByTagName('script')[0];\r\n    x.parentNode.insertBefore(s, x);\r\n  })();\r\n  \r\n  // execute your script immediately here\r\n  SDKName('some arguments');\r\n</script>\r\n```\r\n\r\nThe result will lead to undefined because the `SDKName()` execute before the script loaded, \r\ntherefore we should do some tricks and make sure the script execute successfully. \r\nThe event will store in the `SDKName.q` queue array, \r\nyour SDK should handle and execute `SDKName.q` and reinitial the namespace `SDKName`.\r\n\r\n```js\r\n<script>\r\n  (function () {\r\n    // add a queue event here\r\n    SDKName = SDKName || function () {\r\n      (SDKName.q = SDKName.q || []).push(arguments);\r\n    };\r\n    var s = document.createElement('script');\r\n    s.type = 'text/javascript';\r\n    s.async = true;\r\n    s.src = 'http://xxx.com/sdk.js';\r\n    var x = document.getElementsByTagName('script')[0];\r\n    x.parentNode.insertBefore(s, x);\r\n  })();\r\n  \r\n  // execute your script immediately here\r\n  SDKName('some arguments');\r\n</script>\r\n```\r\n\r\n## SDK Versioning\r\n\r\nPlease avoid using your special case for version like `brand-v<timestamp>.js` `brand-v<datetime>.js` `brand-v1-v2.js`, \r\nit may cause the developer who use the SDK on confusing which is the latest version. \r\n\r\nUse [Semantic Versioning](http://semver.org) to define your SDK Version in the form \"MAJOR.MINOR.PATCH\".\r\nVersion in `v1.0.0` `v1.5.0` `v2.0.0` is easier for them to trace and search for the changelog documentation.\r\n\r\nNormally, we can have different ways to state the SDK version, it depends on your service and design.\r\n\r\nUsing Query String path.\r\n```\r\nhttp://xxx.com/sdk.js?v=1.0.0\r\n```\r\n\r\nUsing the Folder Naming.\r\n```\r\nhttp://xxx.com/v1.0.0/sdk.js\r\n```\r\n\r\nUsing hostname (subdomain).\r\n```\r\nhttp://v1.xxx.com/sdk.js\r\n```\r\n\r\nFor the futher development, you are advised to use  `stable` `unstable` `alpha` `latest` `experimental` version.\r\n```\r\nhttp://xxx.com/sdk-stable.js\r\nhttp://xxx.com/sdk-unstable.js\r\nhttp://xxx.com/sdk-alpha.js\r\nhttp://xxx.com/sdk-latest.js\r\nhttp://xxx.com/sdk-experimental.js\r\n```\r\n\r\n## Changelog Document\r\n\r\nYou should notice that your SDK user will not know if you upgrade your sdk without announcement. \r\nRemember to write a changelog to document your major, minor and even bug fix change. \r\nIt will be a good developer experience if we can trace the changing API for the SDK.\r\n\r\n## Namespace\r\n\r\nYou should not define more than one global namespace in your SDK and \r\nprevent using the common word for your namespace to avoid collision with other libraries.\r\n\r\nOn your SDK mainland, you should use `(function () { ... })()` to wrap all your source.\r\n\r\n## Storage Mechanism\r\n\r\n### Cookie\r\n\r\nThe domain scope of using cookie is quite complex while involving the `subdomain` and `path`.\r\n\r\nFor `path=/`, \r\nyou have a cookie `first=value1` in domain `http://github.com`, \r\nanother cookie `second=value2` in domain `http://sub.github.com`\r\n\r\n|  | http://github.com | http://sub.github.com \r\n|:---------:|:------------:|:------------:\r\nfirst=value1\t | ✓ | ✓\r\nsecond=value2 | ✘ | ✓\r\n\r\nYou have a cookie `first=value1` in domain `http://github.com`,\r\ncookie `second=value2` in domain path `http://github.com/path1`\r\nand cookie `third=value3` in domain `http://sub.github.com`,\r\n\r\n\r\n|  | http://github.com | http://github.com/path1 | http://sub.github.com\r\n|:---------:|:------------:|:------------:|:------------:\r\nfirst=value1\t | ✓ | ✓ | ✓\r\nsecond=value2 | ✘ | ✓ | ✘\r\nthird=value3 | ✘ | ✘ | ✓\r\n\r\n#### Check Cookie Writable\r\n\r\nGiven a domain (Default as current hostname), check whether the cookie is writable.\r\n\r\n```js\r\nvar checkCookieWritable = function(domain) {\r\n    try {\r\n        // Create cookie\r\n        document.cookie = 'cookietest=1' + (domain ? '; domain=' + domain : '');\r\n        var ret = document.cookie.indexOf('cookietest=') != -1;\r\n        // Delete cookie\r\n        document.cookie = 'cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT' + (domain ? '; domain=' + domain : '');\r\n        return ret;\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n};\r\n```\r\n\r\n#### Check Third Party Cookie Writable\r\n\r\nIt's impossible to check only using client side javascript, you need a server to do that. ([Example](https://dl.dropboxusercontent.com/u/105727/web/3rd/third-party-cookies.html))\r\n\r\n### Session\r\n\r\nIt's important to know that Javascript is not possible to write Session, \r\nplease refer to the server side team to implement Session.\r\n\r\n### LocalStorage\r\n\r\nStores data with no expiration date, storage limit is far larger (at least 5MB) and \r\ninformation is never transferred to the server.\r\n\r\nIt's good to know that each localStorage from `http` and `https` in same domain aren't shared.\r\nYou can create an iframe inside the website and use `postMessage` to pass the value to others. [HOW TO?](http://stackoverflow.com/questions/10502469/is-there-any-workaround-to-make-use-of-html5-localstorage-on-both-http-and-https)\r\n\r\n#### Check LocalStorage Writable\r\n\r\nwindow.localStorage is not support in every browser, SDK should check available before using it.\r\n\r\n```js\r\nvar testCanLocalStorage = function() {\r\n   var mod = 'modernizr';\r\n   try {\r\n       localStorage.setItem(mod, mod);\r\n       localStorage.removeItem(mod);\r\n       return true;\r\n   } catch (e) {\r\n       return false;\r\n   }\r\n};\r\n```\r\n\r\n### Session Storage\r\n\r\nStores data for one session (data is lost when the tab is closed).\r\n\r\n### Check SessionStorage Writable\r\n\r\n```js\r\nvar checkCanSessionStorage = function() {\r\n  var mod = 'modernizr';\r\n  try {\r\n    sessionStorage.setItem(mod, mod);\r\n    sessionStorage.removeItem(mod);\r\n    return true;\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n```\r\n\r\n## Request\r\n\r\nThe communication between our SDK and Server is using Ajax Request, \r\nas we know we can use jQuery ajax http request to communicate with Server, \r\nbut there's a better solution to implement it.\r\n\r\n### Image Beacon\r\n\r\nUse the Image Beacon to ask browser to perform a method GET Request to get an Image.\r\n\r\n```js\r\n(new Image()).src = 'http://xxxxx.com/collect?id=1111';\r\n```\r\n\r\n### Single Post\r\n\r\nUse the native form element method POST to send a key value.\r\n\r\n```js\r\nvar form = document.createElement('form');\r\nvar input = document.createElement('input');\r\n\r\nform.style.display = 'none';\r\nform.setAttribute('method', 'POST');\r\nform.setAttribute('action', 'http://xxxx.com/track');\r\n\r\ninput.name = 'username';\r\ninput.value = 'attacker';\r\n\r\nform.appendChild(input);\r\ndocument.getElementsByTagName('body')[0].appendChild(form);\r\n\r\nform.submit();\r\n```\r\n\r\n### Multiple Post\r\n\r\nThe Service is often complex, we need to send more data through method POST.\r\n\r\n```js\r\nfunction requestWithoutAjax( url, params, method ){\r\n\r\n    params = params || {};\r\n    method = method || \"post\";\r\n\r\n    // function to remove the iframe\r\n    var removeIframe = function( iframe ){\r\n        iframe.parentElement.removeChild(iframe);\r\n    };\r\n\r\n    // make a iframe...\r\n    var iframe = document.createElement('iframe');\r\n    iframe.style.display = 'none';\r\n\r\n    iframe.onload = function(){\r\n        var iframeDoc = this.contentWindow.document;\r\n\r\n        // Make a invisible form\r\n        var form = iframeDoc.createElement('form');\r\n        form.method = method;\r\n        form.action = url;\r\n        iframeDoc.body.appendChild(form);\r\n\r\n        // pass the parameters\r\n        for( var name in params ){\r\n            var input = iframeDoc.createElement('input');\r\n            input.type = 'hidden';\r\n            input.name = name;\r\n            input.value = params[name];\r\n            form.appendChild(input);\r\n        }\r\n\r\n        form.submit();\r\n        // remove the iframe\r\n        setTimeout( function(){ \r\n            removeIframe(iframe);\r\n        }, 500);\r\n    };\r\n\r\n    document.body.appendChild(iframe);\r\n}\r\n```\r\n```js\r\nrequestWithoutAjax('url/to', { id: 2, price: 2.5, lastname: 'Gamez'});\r\n```\r\n\r\n### Iframe\r\n\r\nIf you request is more complicated, use iframe.\r\n\r\n```js\r\nvar iframe = document.createElement('iframe');\r\nvar body = document.getElementsByTagName('body')[0];\r\n\r\niframe.style.display = 'none';\r\niframe.src = 'http://xxxx.com/page';\r\niframe.onreadystatechange = function () {\r\n    if (iframe.readyState !== 'complete') {\r\n        return;\r\n    }\r\n};\r\n\r\nbody.append(iframe);\r\n```\r\n### XMLHttpRequest\r\n\r\n## Component of URI\r\n\r\nIt's important to know if your SDK need to parse the location url.\r\n```\r\n                         authority\r\n                   __________|_________\r\n                  /                    \\\r\n              userinfo                host                          resource\r\n               __|___                ___|___                 __________|___________\r\n              /      \\              /       \\               /                      \\\r\n         username  password     hostname    port     path & segment      query   fragment\r\n           __|___   __|__    ______|______   |   __________|_________   ____|____   |\r\n          /      \\ /     \\  /             \\ / \\ /                    \\ /         \\ / \\\r\n    foo://username:password@www.example.com:123/hello/world/there.html?name=ferret#foo\r\n    \\_/                     \\ / \\       \\ /    \\__________/ \\     \\__/\r\n     |                       |   \\       |           |       \\      |\r\n  scheme               subdomain  \\     tld      directory    \\   suffix\r\n                                   \\____/                      \\___/\r\n                                      |                          |\r\n                                    domain                   filename\r\n```\r\n\r\n### Parsing URI\r\n\r\nHere's a simplest by using the native URL() Interface but it doesn't support on all the browsers.\r\n\r\n```js\r\nvar parser = new URL('http://github.com/huei90');\r\nparser.hostname; // => \"github.com\"\r\n```\r\n\r\nFor the browser which doesn't have the URL() Interface, try DOM createElement('a').\r\n\r\n```js\r\nvar parser = document.createElement('a');\r\nparser.href = \"http://github.com/huei90\";\r\nparser.hostname; // => \"github.com\"\r\n```\r\n\r\n## Book to Read\r\n\r\n1. [Third-Party Javascript](http://thirdpartyjs.com)\r\n\r\n## Reference\r\n\r\n1. [What is Software Development Kit](http://www.webopedia.com/TERM/S/SDK.html)\r\n2. [A window.fetch JavaScript polyfill.](https://github.com/github/fetch)\r\n3. [POST Request](http://stackoverflow.com/questions/692196/post-request-javascript/25423688#25423688)\r\n4. [Semantic VersioningVersioning 2.0.0](http://semver.org)\r\n5. [HTTP API design guide extracted from work on the Heroku Platform API](https://github.com/interagent/http-api-design)\r\n6. [Understanding URIs](http://medialize.github.io/URI.js/about-uris.html)\r\n7. [URI Parsing with Javascript](https://gist.github.com/jlong/2428561)\r\n8. [Modernizr: the feature detection library for HTML5/CSS3](http://modernizr.com)\r\n9. [HTML5 Web Storage](http://www.w3schools.com/html/html5_webstorage.asp)\r\n10. [Check if third-party cookies are enabled](http://stackoverflow.com/questions/3550790/check-if-third-party-cookies-are-enabled)\r\n11. [Introduction to Analytics.js - Universal Analytics Web Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}